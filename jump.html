<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Run to You ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CORE --- */
        * { box-sizing: border-box; touch-action: none; -webkit-tap-highlight-color: transparent; }
        body, html {
            height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden;
            font-family: 'Quicksand', sans-serif;
            background: #222;
            user-select: none; -webkit-user-select: none;
        }

        /* --- GAME CONTAINER --- */
        #game-stage {
            position: relative; width: 100%; height: 100%;
            overflow: hidden;
            transition: background 1.5s ease;
        }

        /* --- THEMES --- */
        .theme-night { background: linear-gradient(to bottom, #0f172a 0%, #312e81 100%); }
        .theme-day { background: linear-gradient(to bottom, #38bdf8 0%, #c4b5fd 100%); }

        /* --- UI OVERLAYS --- */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100; pointer-events: none;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        .score-board {
            position: absolute; top: 20px; right: 20px;
            font-family: 'Pacifico', cursive; font-size: 1.5rem; color: white;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
        }

        .game-over-screen, .start-screen, .win-screen {
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            padding: 2rem; border-radius: 20px; text-align: center;
            pointer-events: auto; /* Buttons inside must be clickable */
            transition: opacity 0.3s;
        }
        .hidden { opacity: 0; pointer-events: none; display: none; } /* Added display none to be safe */

        .btn {
            background: #ec4899; color: white; padding: 12px 30px;
            border-radius: 99px; font-weight: bold; font-size: 1.2rem;
            margin-top: 20px; cursor: pointer; border: 4px solid white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: transform 0.1s;
            display: inline-block;
            touch-action: manipulation; /* Allow touch */
        }
        .btn:active { transform: scale(0.95); }

        /* --- CELESTIAL BODIES --- */
        .celestial-body {
            position: absolute; top: 10%; right: 10%;
            width: 80px; height: 80px; border-radius: 50%;
            transition: transform 1.5s ease, opacity 1.5s ease, background 1.5s ease;
        }
        .moon { background: #f1f5f9; box-shadow: 0 0 20px rgba(255,255,255,0.5); }
        .sun { background: #fcd34d; box-shadow: 0 0 40px rgba(251, 191, 36, 0.8); transform: scale(1.1); }

        /* --- BACKGROUND ELEMENTS --- */
        .star {
            position: absolute; background: white; border-radius: 50%;
            width: 3px; height: 3px; opacity: 0.8; animation: twinkle 2s infinite;
        }
        .cloud {
            position: absolute; background: rgba(255,255,255,0.8); border-radius: 20px; opacity: 0.9;
        }
        @keyframes twinkle { 0%,100%{opacity:0.3} 50%{opacity:1} }

        /* --- GROUND --- */
        .ground {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 15%;
            background: #22c55e;
            border-top: 6px solid #4ade80;
            z-index: 10;
        }
        .ground-detail {
            position: absolute; bottom: 0; background: rgba(0,0,0,0.1); width: 100%; height: 50%;
        }

        /* --- RUNNER --- */
        #runner {
            position: absolute; bottom: 15%; left: 15%;
            width: 60px; height: 120px; z-index: 20;
        }

        /* Character Visuals */
        .character-visual { width: 100%; height: 100%; position: relative; transition: opacity 0.5s ease; }
        .head {
            width: 50px; height: 50px; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            border-radius: 50%; border: 3px solid white; overflow: hidden; z-index: 5; background: white;
        }
        .head img { width: 100%; height: 100%; object-fit: cover; }
        .torso {
            width: 30px; height: 40px; position: absolute; top: 45px; left: 50%; transform: translateX(-50%);
            border-radius: 8px; z-index: 4;
        }
        .limb {
            width: 10px; height: 35px; position: absolute; border-radius: 5px; transform-origin: top center;
        }
        .arm { top: 48px; } .leg { top: 80px; }

        /* Colors */
        .him .torso { background: #3b82f6; } .him .arm { background: #bfdbfe; } .him .leg { background: #1e293b; }
        .her .torso { background: #ec4899; } .her .arm { background: #fbcfe8; } .her .leg { background: #831843; }

        /* Animations */
        .running .leg.left { animation: runLegs 0.6s infinite linear; left: 18px; }
        .running .leg.right { animation: runLegs 0.6s infinite linear reverse; right: 18px; }
        .running .arm.left { animation: runArms 0.6s infinite linear reverse; left: 10px; }
        .running .arm.right { animation: runArms 0.6s infinite linear; right: 10px; }
        @keyframes runLegs { 0% { transform: rotate(30deg); } 50% { transform: rotate(-30deg); } 100% { transform: rotate(30deg); } }
        @keyframes runArms { 0% { transform: rotate(-40deg); } 50% { transform: rotate(40deg); } 100% { transform: rotate(-40deg); } }
        .jumping .leg.left { transform: rotate(-20deg); animation: none; }
        .jumping .leg.right { transform: rotate(10deg); animation: none; }
        .jumping .arm { transform: rotate(-140deg); animation: none; }

        /* --- OBSTACLES --- */
        .obstacle {
            position: absolute; bottom: 15%; left: 100%;
            width: 40px; height: 40px; background: #475569;
            border-radius: 8px; box-shadow: inset 0 0 10px rgba(0,0,0,0.5); z-index: 15;
        }
        .obstacle::after {
            content: ''; position: absolute; top: -10px; left: 10px;
            width: 20px; height: 10px; background: #475569; border-radius: 5px 5px 0 0;
        }

        /* --- FINISH LINE --- */
        .finish-line {
            position: absolute; bottom: 15%; left: 100%;
            width: 20px; height: 200px;
            background: repeating-linear-gradient(45deg, #fff, #fff 10px, #000 10px, #000 20px);
            z-index: 15; border: 2px solid white;
        }
        .finish-tape {
            position: absolute; bottom: 150px; left: 100%;
            width: 100px; height: 10px; background: #ec4899;
            z-index: 15;
        }

    </style>
</head>
<body>

    <div id="game-stage" class="theme-night">
        
        <div id="celestial" class="celestial-body moon"></div>
        <div id="sky-objects"></div>
        <div class="score-board">Score: <span id="score">0</span></div>

        <!-- RUNNER -->
        <div id="runner">
            <div id="char-him" class="character-visual him">
                <div class="head"><img src="hugimages/himblue.jpg" alt="Him"></div>
                <div class="torso"></div><div class="limb arm left"></div><div class="limb arm right"></div><div class="limb leg left"></div><div class="limb leg right"></div>
            </div>
            <div id="char-her" class="character-visual her" style="display: none;">
                <div class="head"><img src="hugimages/herpink.jpg" alt="Her"></div>
                <div class="torso"></div><div class="limb arm left"></div><div class="limb arm right"></div><div class="limb leg left"></div><div class="limb leg right"></div>
            </div>
        </div>

        <div class="ground"><div class="ground-detail"></div></div>

        <!-- UI SCREENS -->
        <div class="ui-layer">
            <div id="start-screen" class="start-screen">
                <h1 class="font-pacifico text-4xl text-white mb-2">Night Run</h1>
                <p class="text-white mb-4">Tap to Jump. Avoid the rocks.<br>Finish Line at 208!</p>
                <!-- Removed onclick, added ID for safer binding -->
                <button id="start-btn" class="btn">Start Run üèÉ‚Äç‚ôÇÔ∏è</button>
            </div>
            
            <div id="game-over-screen" class="game-over-screen hidden">
                <h1 class="font-pacifico text-4xl text-pink-500 mb-2">Ouch!</h1>
                <p class="text-white mb-4">Score: <span id="final-score">0</span></p>
                <button id="retry-btn" class="btn">Try Again üîÑ</button>
                <br><a href="index.html" class="inline-block mt-4 text-white underline text-sm">Back Home</a>
            </div>

            <div id="win-screen" class="win-screen hidden">
                <h1 class="font-pacifico text-5xl text-yellow-400 mb-2">You Made It! ‚ù§Ô∏è</h1>
                <p class="text-white mb-4 text-lg">We reached the goal together!</p>
                <div class="text-6xl my-4">üèÅüèÜüèÅ</div>
                <button id="win-retry-btn" class="btn">Run Again üèÉ‚Äç‚ôÇÔ∏è</button>
                <br><a href="index.html" class="inline-block mt-4 text-white underline text-sm">Back Home</a>
            </div>
        </div>

    </div>

    <script>
        const config = {
            gravity: 0.6,
            jumpStrength: 13,
            baseSpeed: 5,
            speedIncrement: 0.001,
            spawnRate: 2500, // Distance between rocks
            dayNightCycle: 15000,
            targetScore: 208
        };

        let state = {
            running: false,
            score: 0,
            speed: config.baseSpeed,
            dy: 0, y: 0,
            isJumping: false,
            isDay: false,
            lastTime: 0,
            obstacleTimer: 0,
            cycleTimer: 0,
            finishLineSpawned: false
        };

        const runnerEl = document.getElementById('runner');
        const himEl = document.getElementById('char-him');
        const herEl = document.getElementById('char-her');
        const stageEl = document.getElementById('game-stage');
        const celestialEl = document.getElementById('celestial');
        const scoreEl = document.getElementById('score');
        
        let obstacles = [];
        let finishLineEl = null;
        let animationFrameId;

        // --- SAFE INPUT HANDLING ---
        function handleInput(e) {
            // IGNORE clicks on buttons (let them handle themselves)
            if (e.target.closest('.btn') || e.target.closest('a')) {
                return;
            }

            // Prevent scrolling ONLY on the game stage
            if (e.type === 'touchstart') e.preventDefault();
            
            if (!state.running) return;
            
            if (!state.isJumping) {
                state.dy = config.jumpStrength;
                state.isJumping = true;
                runnerEl.classList.add('jumping');
                runnerEl.classList.remove('running');
            }
        }

        // Attach listeners to document to catch taps anywhere
        document.addEventListener('touchstart', handleInput, { passive: false });
        document.addEventListener('mousedown', handleInput);
        document.addEventListener('keydown', (e) => { if(e.code === 'Space') handleInput(e); });

        // --- BUTTON BINDING (Fix for unclickable buttons) ---
        function bindButton(id, action) {
            const btn = document.getElementById(id);
            if (!btn) return;
            
            const handler = (e) => {
                e.stopPropagation(); // Stop game from jumping when clicking button
                action();
            };
            
            // Bind both to ensure it catches one of them
            btn.addEventListener('touchstart', handler, { passive: false });
            btn.addEventListener('click', handler);
        }

        bindButton('start-btn', startGame);
        bindButton('retry-btn', resetGame);
        bindButton('win-retry-btn', resetGame);


        // --- GAME LOGIC ---
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('win-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            
            // Clean slate
            obstacles.forEach(o => o.el.remove());
            obstacles = [];
            if(finishLineEl) { finishLineEl.remove(); finishLineEl = null; }

            state.running = true;
            state.score = 0;
            state.speed = config.baseSpeed;
            state.y = 0; state.dy = 0;
            state.obstacleTimer = 0; state.cycleTimer = 0;
            state.isDay = false;
            state.finishLineSpawned = false;
            
            updateTheme();
            runnerEl.classList.add('running');
            runnerEl.style.transform = `translateY(0px)`; // Reset position
            
            state.lastTime = performance.now();
            animationFrameId = requestAnimationFrame(update);
        }

        function update(time) {
            if (!state.running) return;
            const dt = time - state.lastTime;
            state.lastTime = time;

            // Physics
            if (state.isJumping) {
                state.y += state.dy;
                state.dy -= config.gravity * (dt / 16);
                if (state.y <= 0) {
                    state.y = 0; state.dy = 0;
                    state.isJumping = false;
                    runnerEl.classList.remove('jumping');
                    runnerEl.classList.add('running');
                }
                runnerEl.style.transform = `translateY(${-state.y}px)`;
            }

            const currentDisplayedScore = Math.floor(state.score / 10);

            // Win Condition
            if (currentDisplayedScore >= config.targetScore && !state.finishLineSpawned) {
                spawnFinishLine();
                state.finishLineSpawned = true;
            }

            // Spawn Obstacles
            if (!state.finishLineSpawned) {
                state.obstacleTimer += dt;
                if (state.obstacleTimer > config.spawnRate / (state.speed/5)) {
                    spawnObstacle();
                    state.obstacleTimer = 0;
                }
            }
            
            moveObstacles(dt);
            if (state.finishLineSpawned) moveFinishLine(dt);

            state.score++;
            state.speed += config.speedIncrement;
            scoreEl.innerText = currentDisplayedScore;

            // Cycle
            state.cycleTimer += dt;
            if (state.cycleTimer > config.dayNightCycle) {
                toggleDayNight();
                state.cycleTimer = 0;
            }

            checkCollision();
            animationFrameId = requestAnimationFrame(update);
        }

        function spawnObstacle() {
            const obs = document.createElement('div');
            obs.classList.add('obstacle');
            const heightVar = 0.8 + Math.random() * 0.4;
            obs.style.transform = `scaleY(${heightVar})`;
            obs.style.left = '100%';
            stageEl.appendChild(obs);
            obstacles.push({ el: obs });
        }

        function spawnFinishLine() {
            finishLineEl = document.createElement('div');
            finishLineEl.classList.add('finish-line');
            finishLineEl.style.left = '100%'; 
            stageEl.appendChild(finishLineEl);
        }

        function moveObstacles(dt) {
            const pxSpeed = state.speed * (dt / 16); 
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obs = obstacles[i];
                const rect = obs.el.getBoundingClientRect();
                const newLeft = rect.left - pxSpeed;
                obs.el.style.left = newLeft + 'px';
                if (newLeft < -50) {
                    obs.el.remove();
                    obstacles.splice(i, 1);
                }
            }
        }

        function moveFinishLine(dt) {
            if (!finishLineEl) return;
            const pxSpeed = state.speed * (dt / 16);
            const rect = finishLineEl.getBoundingClientRect();
            const newLeft = rect.left - pxSpeed;
            finishLineEl.style.left = newLeft + 'px';

            const runnerRect = runnerEl.getBoundingClientRect();
            if (rect.left < runnerRect.right) {
                gameWin();
            }
        }

        function checkCollision() {
            const runnerRect = runnerEl.getBoundingClientRect();
            const hitBox = { left: runnerRect.left + 15, right: runnerRect.right - 15, top: runnerRect.top + 10, bottom: runnerRect.bottom - 5 };

            obstacles.forEach(obs => {
                const obsRect = obs.el.getBoundingClientRect();
                const obsHitBox = { left: obsRect.left + 5, right: obsRect.right - 5, top: obsRect.top + 5, bottom: obsRect.bottom };
                if (hitBox.left < obsHitBox.right && hitBox.right > obsHitBox.left && hitBox.bottom > obsHitBox.top) {
                    gameOver();
                }
            });
        }

        function toggleDayNight() {
            state.isDay = !state.isDay;
            updateTheme();
        }

        function updateTheme() {
            if (state.isDay) {
                stageEl.classList.remove('theme-night'); stageEl.classList.add('theme-day');
                celestialEl.classList.remove('moon'); celestialEl.classList.add('sun');
                himEl.style.opacity = '0';
                setTimeout(() => { himEl.style.display = 'none'; herEl.style.display = 'block'; setTimeout(() => herEl.style.opacity = '1', 50); }, 500);
                createSkyObjects(false);
            } else {
                stageEl.classList.remove('theme-day'); stageEl.classList.add('theme-night');
                celestialEl.classList.remove('sun'); celestialEl.classList.add('moon');
                herEl.style.opacity = '0';
                setTimeout(() => { herEl.style.display = 'none'; himEl.style.display = 'block'; setTimeout(() => himEl.style.opacity = '1', 50); }, 500);
                createSkyObjects(true);
            }
        }

        function createSkyObjects(isNight) {
            const container = document.getElementById('sky-objects');
            container.innerHTML = '';
            const count = isNight ? 30 : 6;
            const type = isNight ? 'star' : 'cloud';
            for(let i=0; i<count; i++) {
                const el = document.createElement('div');
                el.classList.add(type);
                el.style.top = Math.random() * 60 + '%';
                el.style.left = Math.random() * 100 + '%';
                if(!isNight) {
                    const w = 50 + Math.random() * 50;
                    el.style.width = w + 'px'; el.style.height = (w*0.4)+'px';
                }
                container.appendChild(el);
            }
        }

        function gameOver() {
            state.running = false;
            runnerEl.classList.remove('running');
            document.getElementById('final-score').innerText = Math.floor(state.score / 10);
            document.getElementById('game-over-screen').classList.remove('hidden');
        }

        function gameWin() {
            state.running = false;
            runnerEl.classList.remove('running');
            document.getElementById('win-screen').classList.remove('hidden');
        }

        function resetGame() {
            obstacles.forEach(o => o.el.remove());
            obstacles = [];
            if(finishLineEl) { finishLineEl.remove(); finishLineEl = null; }
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('win-screen').classList.add('hidden');
            startGame();
        }

        createSkyObjects(true);
    </script>
</body>
</html>