<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For You ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            background-color: #fdf2f8;
            touch-action: manipulation;
        }

        /* --- 1. INTRO LAYER (CANVAS) --- */
        #intro-layer {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            /* Deep Twilight Purple Background to make pink pop */
            background: radial-gradient(circle at center, #2e1065 0%, #0f172a 100%);
            z-index: 50;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 1.5s ease;
        }

        canvas#gardenCanvas {
            display: block;
            /* Subtle glow for the whole garden */
            filter: drop-shadow(0 0 15px rgba(255, 182, 193, 0.3));
        }

        .tap-instruction {
            position: absolute;
            top: 15%;
            width: 100%;
            text-align: center;
            color: #e9d5ff; 
            opacity: 0;
            animation: fadeIn 1s forwards 4.5s; /* Wait for garden to finish */
            z-index: 60;
            pointer-events: none;
        }

        /* --- 2. GAME LAYER STYLES --- */
        #game-layer {
            display: none;
            height: 100vh;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            position: relative;
            background: linear-gradient(180deg, #fce7f3 0%, #fbcfe8 100%);
            overflow: hidden;
        }

        /* Running Animation */
        @keyframes run-bob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        .running {
            animation: run-bob 0.3s infinite;
        }

        /* Character Container */
        .character-container {
            position: absolute;
            bottom: 25%;
            width: 80px;
            height: 140px;
            z-index: 20;
            transition: left 0.5s ease-out, right 0.5s ease-out, transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* HEAD (Photo Circle) */
        .head-wrapper {
            width: 70px; height: 70px;
            position: absolute; top: 0; left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            background-color: white;
            border-radius: 50%;
            border: 3px solid white;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .head-wrapper img {
            width: 100%; height: 100%; object-fit: cover;
        }

        /* BODY PARTS */
        .torso {
            width: 34px; height: 45px;
            position: absolute; top: 65px; left: 50%;
            transform: translateX(-50%);
            border-radius: 10px; z-index: 3;
        }
        .limb {
            width: 10px; height: 35px;
            position: absolute; border-radius: 10px;
            transform-origin: top center;
            transition: transform 0.5s ease; 
        }
        .arm { top: 70px; z-index: 4; }
        .arm.left { left: 15px; } .arm.right { right: 15px; }
        .leg { top: 105px; z-index: 2; height: 40px; }
        .leg.left { left: 25px; } .leg.right { right: 25px; }

        /* Limb Swinging Animation */
        @keyframes swing-left {
            0% { transform: rotate(30deg); }
            50% { transform: rotate(-30deg); }
            100% { transform: rotate(30deg); }
        }
        @keyframes swing-right {
            0% { transform: rotate(-30deg); }
            50% { transform: rotate(30deg); }
            100% { transform: rotate(-30deg); }
        }
        .running .arm.left { animation: swing-left 0.6s infinite linear; }
        .running .arm.right { animation: swing-right 0.6s infinite linear; }
        .running .leg.left { animation: swing-right 0.6s infinite linear; }
        .running .leg.right { animation: swing-left 0.6s infinite linear; }

        /* Character Colors */
        #char-me { left: 5%; }
        #char-me .torso { background-color: #3b82f6; }   
        #char-me .limb { background-color: #bfdbfe; }     
        #char-me .leg { background-color: #1f2937; }      
        
        #char-girl { right: 5%; transform: scaleX(-1); } 
        #char-girl .head-wrapper { transform: translateX(-50%) scaleX(-1); }
        #char-girl .torso { background-color: #f472b6; } 
        #char-girl .limb { background-color: #fbcfe8; }   
        #char-girl .leg { background-color: #4b5563; }    

        .track {
            width: 100%; height: 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 2px;
            position: absolute; bottom: 25%; z-index: 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Falling Petals */
        .falling-petal {
            position: absolute; background: #ffb7b2; opacity: 0.8;
            border-radius: 100% 0 100% 0;
            animation: fall linear infinite;
        }
        @keyframes fall {
            0% { transform: translate(0, -10px) rotate(0deg); opacity: 1; }
            100% { transform: translate(100px, 100vh) rotate(360deg); opacity: 0; }
        }

        .text-shadow-pink { text-shadow: 2px 2px 0px #f9a8d4; }
        
        .pulse-btn { animation: pulse-heart 1.5s infinite; }
        @keyframes pulse-heart {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(236, 72, 153, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(236, 72, 153, 0); }
        }

        .bubble {
            position: absolute; background: white; color: #ec4899;
            padding: 6px 12px; border-radius: 15px; font-weight: bold;
            font-size: 14px; top: -30px; left: 50%;
            transform: translateX(-50%); white-space: nowrap;
            opacity: 0; transition: opacity 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: 2px solid #fbcfe8; z-index: 30;
        }
        .show-bubble { opacity: 1; }

        .heart-particle {
            position: absolute; font-size: 24px; pointer-events: none;
            animation: floatUp 1s ease-out forwards; z-index: 20;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-120px) scale(1.5); opacity: 0; }
        }
        @keyframes fadeIn { to { opacity: 1; } }

        .win-buttons {
            display: flex; flex-direction: column; gap: 10px; margin-top: 20px; align-items: center;
        }
        .secondary-btn {
            background: white; color: #ec4899; border: 2px solid #ec4899;
            padding: 8px 20px; border-radius: 999px; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;
        }
        .secondary-btn:hover { background: #fdf2f8; transform: translateY(-2px); }

    </style>
</head>
<body>

    <!-- LAYER 1: CANVAS GARDEN INTRO -->
    <div id="intro-layer" onclick="finishIntro()">
        <canvas id="gardenCanvas"></canvas>
        <div class="tap-instruction">
            <h1 class="text-3xl font-pacifico mb-2 text-white drop-shadow-md">Hello, Love</h1>
            <p class="text-sm font-light text-purple-100">Cintaku mekar setiap hari untukmu.</p>
            <p class="mt-6 text-xs uppercase tracking-widest text-purple-300 animate-bounce">(Tap to begin)</p>
        </div>
    </div>

    <!-- LAYER 2: THE GAME -->
    <div id="game-layer">
        <div id="bg-petals" class="absolute inset-0 pointer-events-none overflow-hidden"></div>
        <div class="mt-12 text-center game-content z-20">
            <h2 id="status-text" class="text-4xl font-bold text-pink-500 font-pacifico text-shadow-pink">PELUKAN YUKKKK!</h2>
            <p id="sub-text" class="text-pink-400 text-sm mt-2 font-semibold">Pencet lopnyaaaa cayanggg</p>
        </div>
        <div class="w-full relative h-64 game-content">
            <div class="track"></div>
            
            <div id="char-me" class="character-container running">
                <div class="bubble">Siniiiii!</div>
                <div class="head-wrapper"><img src="hugimages/himblue.jpg" alt="His Face"></div>
                <div class="torso"></div>
                <div class="limb arm left"></div><div class="limb arm right"></div>
                <div class="limb leg left"></div><div class="limb leg right"></div>
            </div>

            <div id="char-girl" class="character-container running">
                <div class="bubble">Nungguin nihhh</div>
                <div class="head-wrapper"><img src="hugimages/herpink.jpg" alt="Her Face"></div>
                <div class="torso"></div>
                <div class="limb arm left"></div><div class="limb arm right"></div>
                <div class="limb leg left"></div><div class="limb leg right"></div>
            </div>
        </div>

        <div class="mb-12 flex flex-col items-center game-content z-20">
            <button id="step-btn" onclick="takeStep()" class="pulse-btn bg-pink-500 active:bg-pink-600 text-white rounded-full w-24 h-24 text-4xl shadow-xl border-4 border-pink-200 flex items-center justify-center transition-all select-none hover:scale-105">
                ‚ù§Ô∏è
            </button>
            <div id="win-menu" class="win-buttons hidden">
                <button onclick="resetGame()" class="secondary-btn">Peluk lagi? ü§ó</button>
                <a href="index.html" class="secondary-btn bg-pink-500 text-white border-none shadow-lg">Kembali ke halaman awal üè†</a>
            </div>
        </div>
    </div>
    <div id="particles" class="fixed inset-0 pointer-events-none z-50"></div>

    <script>
        // --- 1. SYMMETRICAL LILY GARDEN ENGINE ---
        const canvas = document.getElementById('gardenCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Helper: Draw a single Bell
        function drawBell(x, y, angle, scale) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.scale(scale, scale);

            ctx.beginPath();
            ctx.moveTo(0, 0); 
            ctx.bezierCurveTo(15, 5, 20, 25, 10, 35);
            ctx.lineTo(5, 30); ctx.lineTo(0, 35); ctx.lineTo(-5, 30); ctx.lineTo(-10, 35);
            ctx.bezierCurveTo(-20, 25, -15, 5, 0, 0);

            const grad = ctx.createLinearGradient(0, 0, 0, 40);
            grad.addColorStop(0, '#fff0f5'); 
            grad.addColorStop(0.6, '#ff99cc');
            grad.addColorStop(1, '#ff66b2');
            
            ctx.fillStyle = grad;
            ctx.fill();
            ctx.strokeStyle = "rgba(255,255,255,0.4)";
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.restore();
        }

        // Helper: Draw Leaf
        function drawLeaf(x, y, length, width, angle, progress) {
            if(progress <= 0) return;
            const currentLen = length * progress;
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(width, -currentLen/2, 0, -currentLen);
            ctx.quadraticCurveTo(-width, -currentLen/2, 0, 0);
            const grad = ctx.createLinearGradient(0, 0, 0, -currentLen);
            grad.addColorStop(0, '#1b5e20'); grad.addColorStop(1, '#66bb6a');
            ctx.fillStyle = grad;
            ctx.fill();
            ctx.restore();
        }

        // Class representing one Lily Plant
        class Lily {
            constructor(offsetX, scale, mirror, delay) {
                this.offsetX = offsetX;
                this.scale = scale;
                this.mirror = mirror; // true = flip horizontally
                this.delay = delay;
                this.timer = 0;
                
                this.growP = 0;
                this.leafP = 0;
                this.flowerP = 0;
            }

            update() {
                this.timer++;
                if (this.timer < this.delay) return;

                if (this.growP < 1) this.growP += 0.008;
                else if (this.leafP < 1) this.leafP += 0.01;
                else if (this.flowerP < 1) this.flowerP += 0.006;
            }

            draw(ctx, centerX, baseY) {
                if (this.timer < this.delay) return;

                ctx.save();
                ctx.translate(centerX + this.offsetX, baseY);
                
                // Handle Mirroring: Flip X axis
                if (this.mirror) ctx.scale(-this.scale, this.scale);
                else ctx.scale(this.scale, this.scale);

                // 1. Leaves
                drawLeaf(0, 0, 300, 60, -0.3, this.leafP); 
                drawLeaf(0, 0, 350, 70, 0.3, this.leafP);

                // 2. Main Stem
                const currentH = 400 * this.growP;
                ctx.beginPath();
                ctx.moveTo(0, 0);
                
                // Bezier points for arching stem
                if(this.growP < 1) {
                     ctx.quadraticCurveTo(0, -currentH, 0, -currentH);
                } else {
                     ctx.bezierCurveTo(-20, -currentH * 0.5, 100, -currentH * 0.9, 120, -currentH * 0.6);
                }
                
                ctx.lineWidth = 6;
                ctx.strokeStyle = '#4caf50';
                ctx.lineCap = 'round';
                ctx.stroke();

                // 3. Flowers
                if (this.growP >= 1) {
                    const tValues = [0.4, 0.55, 0.7, 0.85, 0.95];
                    
                    // Hardcoded Bezier points matching stem curve above
                    const startX=0, startY=0;
                    const cp1X=-20, cp1Y=-200;
                    const cp2X=100, cp2Y=-360;
                    const endX=120, endY=-240;

                    tValues.forEach((t, index) => {
                        let localP = (this.flowerP * 2) - (index * 0.15);
                        localP = Math.max(0, Math.min(1, localP));
                        
                        if (localP > 0) {
                            // Calculate position on curve
                            const invT = 1 - t;
                            const px = Math.pow(invT, 3)*startX + 3*Math.pow(invT, 2)*t*cp1X + 3*invT*Math.pow(t, 2)*cp2X + Math.pow(t, 3)*endX;
                            const py = Math.pow(invT, 3)*startY + 3*Math.pow(invT, 2)*t*cp1Y + 3*invT*Math.pow(t, 2)*cp2Y + Math.pow(t, 3)*endY;

                            // Pedicel
                            ctx.beginPath();
                            ctx.moveTo(px, py);
                            ctx.quadraticCurveTo(px, py + 10, px + 5, py + 15);
                            ctx.lineWidth = 2;
                            ctx.strokeStyle = '#66bb6a';
                            ctx.stroke();

                            // Bell
                            let bloomScale = localP;
                            if(localP > 0.8) bloomScale += Math.sin(localP * 10) * 0.05; // bounce
                            
                            // Draw Bell (unscaled by bloom, handled inside)
                            drawBell(px + 5, py + 15, 0.2 + (index * 0.1), bloomScale);
                        }
                    });
                }
                ctx.restore();
            }
        }

        // Create the Garden Array
        const gardenLilies = [
            new Lily(0, 1.1, false, 0),    // Center Main (Right curve)
            new Lily(-10, 1.1, true, 20),  // Center Main (Left curve - Mirrored)
            new Lily(140, 0.8, false, 60), // Side Right
            new Lily(-140, 0.8, true, 60), // Side Left
            new Lily(260, 0.6, false, 100),// Far Right
            new Lily(-260, 0.6, true, 100) // Far Left
        ];

        function animateGarden() {
            ctx.clearRect(0, 0, width, height);
            const centerX = width / 2;
            const baseY = height;

            gardenLilies.forEach(lily => {
                lily.update();
                lily.draw(ctx, centerX, baseY);
            });

            requestAnimationFrame(animateGarden);
        }
        animateGarden();


        // --- 2. GAME LOGIC (Unchanged) ---
        const introLayer = document.getElementById('intro-layer');
        const gameLayer = document.getElementById('game-layer');
        const charGirl = document.getElementById('char-girl');
        const charMe = document.getElementById('char-me');
        const stepBtn = document.getElementById('step-btn');
        const statusText = document.getElementById('status-text');
        const subText = document.getElementById('sub-text');
        const winMenu = document.getElementById('win-menu');
        const bgPetals = document.getElementById('bg-petals');
        let posYou = 5; let posMe = 5; let isGameWon = false;
        const messages = ["KANGENNNN", "COMING BABYYY", "DIKIT LAGIII", "LOVE YOU SAYANGGG", "AKU DATANGGG", "JANGAN KEMANA2", "‚ù§Ô∏è"];

        function finishIntro() {
            introLayer.style.opacity = '0';
            setTimeout(() => {
                introLayer.style.display = 'none';
                gameLayer.style.display = 'flex';
                startFallingPetals();
            }, 1500);
        }
        
        // ... (Rest of game logic remains identical to previous versions) ...
        function takeStep() {
            if (isGameWon) return;
            const currentGap = 100 - posYou - posMe - 15; 
            if (currentGap <= 5) { winGame(); } 
            else {
                const stepSize = 3 + Math.random() * 2; 
                posYou += stepSize; charMe.style.left = posYou + '%';
                if (currentGap < 40) { posMe += 1.5; charGirl.style.right = posMe + '%'; }
                spawnHeart(charMe); showBubble(charMe);
                stepBtn.style.transform = `scale(0.9)`;
                setTimeout(() => stepBtn.style.transform = 'scale(1)', 100);
            }
        }

        function winGame() {
            isGameWon = true;
            charMe.style.left = 'calc(50% - 35px)'; charGirl.style.right = 'calc(50% - 35px)';
            charGirl.classList.remove('running'); charMe.classList.remove('running');
            charGirl.style.zIndex = 25; 
            setTimeout(() => {
                charMe.style.transform = "scale(1.1) rotate(15deg)";
                charGirl.style.transform = "scaleX(-1) scale(1.1) rotate(15deg)";
                charMe.querySelectorAll('.arm').forEach(arm => { arm.style.transform = "rotate(-110deg)"; arm.style.height = "40px"; });
                charGirl.querySelectorAll('.arm').forEach(arm => { arm.style.transform = "rotate(-70deg)"; arm.style.height = "40px"; });
            }, 100); 
            for(let i=0; i<50; i++) { setTimeout(() => spawnHeart(charMe, true), i * 30); }
            statusText.innerText = "PELUKAN VIRTUAL DULU AJA YAAA!";
            subText.innerText = "Sejauh mana pun kita, harus tetep kuat yaa sayang, bakalan tetep ada juga caranya :v";
            stepBtn.classList.add("hidden"); winMenu.classList.remove("hidden");
        }

        function resetGame() {
            isGameWon = false; posYou = 5; posMe = 5;
            charMe.style.left = '5%'; charGirl.style.right = '5%';
            charMe.style.transform = "none"; charGirl.style.transform = "scaleX(-1)"; 
            charGirl.classList.add('running'); charMe.classList.add('running');
            document.querySelectorAll('.arm').forEach(arm => arm.style.transform = "");
            statusText.innerText = "PELUKAN YUKKKKK"; subText.innerText = "Pencet lopnyaaaa";
            stepBtn.classList.remove("hidden"); winMenu.classList.add("hidden");
        }

        function spawnHeart(element, isBigExplosion = false) {
            const heart = document.createElement('div');
            heart.classList.add('heart-particle');
            heart.innerText = ['‚ù§Ô∏è','üíñ','‚ú®','üå∏'][Math.floor(Math.random()*4)];
            const rect = element.getBoundingClientRect();
            const randomX = (Math.random() - 0.5) * 40;
            heart.style.left = (rect.left + rect.width/2 + randomX) + 'px';
            heart.style.top = (rect.top) + 'px';
            if (isBigExplosion) {
                heart.style.fontSize = (20 + Math.random() * 30) + 'px';
                heart.style.animationDuration = (1 + Math.random()) + 's';
                const xDir = (Math.random() - 0.5) * 300;
                heart.style.setProperty('--tw-translate-x', `${xDir}px`);
            }
            document.getElementById('particles').appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }

        function showBubble(avatar) {
            const bubble = avatar.querySelector('.bubble');
            if(bubble) {
                bubble.innerText = messages[Math.floor(Math.random() * messages.length)];
                bubble.classList.add('show-bubble');
                setTimeout(() => bubble.classList.remove('show-bubble'), 800);
            }
        }

        function startFallingPetals() {
            setInterval(() => {
                const petal = document.createElement('div');
                petal.classList.add('falling-petal');
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.width = (10 + Math.random() * 10) + 'px';
                petal.style.height = (10 + Math.random() * 10) + 'px';
                petal.style.animationDuration = (4 + Math.random() * 5) + 's';
                bgPetals.appendChild(petal);
                setTimeout(() => petal.remove(), 9000);
            }, 300);
        }
    </script>
</body>
</html>